<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Mini ChatScript.js Demo</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f0f0; padding:20px; }
    #chat { width:100%; max-width:600px; margin:auto; background:white; padding:10px; border-radius:8px; height:400px; overflow-y:auto; box-shadow:0 0 10px rgba(0,0,0,0.2);}
    .message { margin:5px 0; }
    .user { color:blue; }
    .bot { color:green; }
    #input { width:100%; padding:10px; margin-top:10px; border-radius:5px; border:1px solid #ccc; }
  </style>
</head>
<body>

<h2>Mini ChatScript.js Demo</h2>
<div id="chat"></div>
<input type="text" id="input" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">

<script>
class ChatScriptJS {
    constructor() {
        this.rules = [];
        this.context = {};
        this.memory = {};
        this.topic = "default";
    }

    addRule(pattern, response, topic="default") {
        this.rules.push({ pattern, response, topic });
    }

    reply(input, userId="global") {
        input = input.toLowerCase().trim();
        if (!this.context[userId]) this.context[userId] = { topic: this.topic, history: [] };
        const ctx = this.context[userId];

        let matched = null;
        for (let rule of this.rules) {
            if (rule.topic === ctx.topic) {
                const regex = new RegExp(rule.pattern, "i");
                const match = input.match(regex);
                if (match) { matched = { rule, match }; break; }
            }
        }

        if (!matched) {
            for (let rule of this.rules) {
                const regex = new RegExp(rule.pattern, "i");
                const match = input.match(regex);
                if (match) { matched = { rule, match }; break; }
            }
        }

        let response;
        if (matched) {
            response = matched.rule.response.replace(/<star>/g, matched.match[1] || "");
            ctx.topic = matched.rule.topic;
        } else {
            response = "I don't understand that yet.";
        }

        ctx.history.push({ user: input, bot: response });
        return response;
    }

    getContext(userId="global") {
        return this.context[userId];
    }
}

// Ï±óÎ¥á Ï¥àÍ∏∞Ìôî
const bot = new ChatScriptJS();
bot.addRule("^hello$", "Hi there!", "greetings");
bot.addRule("^my name is (.+)$", "Nice to meet you, <star>!", "greetings");
bot.addRule("^what's my name\\?$", "Your name is " + (bot.memory["username"] || "unknown") + ".", "greetings");

// HTML ÏöîÏÜå
const chatDiv = document.getElementById("chat");
const inputBox = document.getElementById("input");

function addMessage(text, sender) {
    const div = document.createElement("div");
    div.className = "message " + sender;
    div.textContent = (sender==="user" ? "üë§ " : "ü§ñ ") + text;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

// ÏûÖÎ†• Ïù¥Î≤§Ìä∏
inputBox.addEventListener("keypress", function(e){
    if (e.key === "Enter") {
        const userText = inputBox.value;
        addMessage(userText, "user");
        inputBox.value = "";

        // Ïù¥Î¶Ñ Í∏∞ÏñµÏö© ÏòàÏãú
        const nameMatch = userText.match(/^my name is (.+)$/i);
        if(nameMatch) bot.memory["username"] = nameMatch[1];

        const botReply = bot.reply(userText);
        addMessage(botReply, "bot");
    }
});
</script>

</body>
</html>
